<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documenta√ß√£o SQL Completa - Loja Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1d4ed8', // Azul principal para t√≠tulos e destaque
            secondary: '#0284c7', // Azul secund√°rio para n√∫meros em cards
            background: '#f8fafc', // Fundo bem claro
            cardBg: '#e0f2fe', // Fundo dos cards
            codeBg: '#f1f5f9', // Fundo dos blocos de c√≥digo
          },
          fontFamily: {
            sans: ['Inter', 'Arial', 'sans-serif'], // Usando Inter como fonte sans-serif padr√£o
            mono: ['Fira Code', 'Menlo', 'monospace'], // Fonte para c√≥digos, ideal para legibilidade
          },
        }
      }
    }
  </script>
  <style>
    /* Estilo adicional para posicionar o bot√£o de copiar */
    .code-block-container {
      position: relative;
    }
    .copy-button {
      position: absolute;
      top: 0.75rem; /* 12px */
      right: 0.75rem; /* 12px */
      padding: 0.5rem 0.75rem; /* 8px 12px */
      font-size: 0.875rem; /* 14px */
      line-height: 1.25rem; /* 20px */
      border-radius: 0.375rem; /* 6px */
      cursor: pointer;
      opacity: 0; /* Come√ßa invis√≠vel */
      transition: opacity 0.3s ease-in-out, background-color 0.2s ease-in-out;
      background-color: rgba(255, 255, 255, 0.9);
      color: #3b82f6; /* Tailwind blue-500 */
      border: 1px solid #bfdbfe; /* Tailwind blue-200 */
      font-weight: 500;
    }
    .code-block-container:hover .copy-button {
      opacity: 1; /* Fica vis√≠vel ao passar o mouse */
    }
    .copy-button:hover {
      background-color: #dbeafe; /* Tailwind blue-100 */
      color: #2563eb; /* Tailwind blue-600 */
    }
    .copy-button:active {
      transform: translateY(1px); /* Pequeno efeito de clique */
    }
  </style>
</head>
<body class="font-sans antialiased bg-background text-gray-800 p-6 sm:p-8 md:p-12 leading-relaxed">

  <header class="text-center mb-12">
    <h1 class="text-5xl font-extrabold text-primary mb-4 animate-fade-in-down">
      üìÑ Documenta√ß√£o SQL ‚Äì Estrutura Detalhada da Loja Online
    </h1>
    <p class="text-xl text-gray-600">
      Um guia completo para entender o banco de dados da nossa plataforma de e-commerce.
    </p>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-16 max-w-6xl mx-auto">
    <div class="flex flex-col items-center justify-center bg-cardBg p-8 rounded-xl shadow-lg text-center transform transition-all duration-300 hover:scale-105 hover:shadow-xl">
      <strong class="block text-6xl font-extrabold text-secondary mb-3">6</strong>
      <span class="text-2xl text-blue-900 font-semibold">Tabelas</span>
      <p class="text-gray-700 mt-2 text-sm">Estruturas fundamentais dos dados.</p>
    </div>
    <div class="flex flex-col items-center justify-center bg-cardBg p-8 rounded-xl shadow-lg text-center transform transition-all duration-300 hover:scale-105 hover:shadow-xl">
      <strong class="block text-6xl font-extrabold text-secondary mb-3">7</strong>
      <span class="text-2xl text-blue-900 font-semibold">Views</span>
      <p class="text-gray-700 mt-2 text-sm">Consultas pr√©-definidas para insights.</p>
    </div>
    <div class="flex flex-col items-center justify-center bg-cardBg p-8 rounded-xl shadow-lg text-center transform transition-all duration-300 hover:scale-105 hover:shadow-xl">
      <strong class="block text-6xl font-extrabold text-secondary mb-3">0</strong>
      <span class="text-2xl text-blue-900 font-semibold">Triggers</span>
      <p class="text-gray-700 mt-2 text-sm">A√ß√µes automatizadas no banco de dados.</p>
    </div>
  </div>

  <hr class="my-16 border-t-2 border-gray-200 max-w-4xl mx-auto">

  <main class="max-w-4xl mx-auto">
    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">1. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">usuarios</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-usuarios">CREATE TABLE public.usuarios (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT,
  email TEXT NOT NULL UNIQUE,
  senha TEXT NOT NULL,
  telefone TEXT,
  avatar_url TEXT,
  papel TEXT,
  empresa_ref BIGINT,
  user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  CONSTRAINT usuarios_empresa_ref_fkey FOREIGN KEY (empresa_ref) REFERENCES empresa (id)
);</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">2. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">produtos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-produtos">CREATE TABLE public.produtos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT NOT NULL,
  descricao TEXT,
  preco NUMERIC(10,2),
  categoria TEXT,
  imagem_principal TEXT,
  link_afiliado TEXT,
  tipo TEXT DEFAULT 'proprio',
  ativo BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">3. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">fotos_produtos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-fotos-produtos">CREATE TABLE public.fotos_produtos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  produto_id BIGINT NOT NULL REFERENCES produtos(id) ON DELETE CASCADE,
  url TEXT NOT NULL
);</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">4. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">avaliacoes</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-avaliacoes">CREATE TABLE public.avaliacoes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  produto_id BIGINT NOT NULL REFERENCES produtos(id) ON DELETE CASCADE,
  usuario_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  nota INTEGER CHECK (nota >= 1 AND nota <= 5),
  comentario TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  UNIQUE (produto_id, usuario_id)
);</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">5. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">pedidos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-pedidos">CREATE TABLE pedidos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  usuario_id UUID REFERENCES auth.users(id),
  status TEXT DEFAULT 'pendente',
  total NUMERIC(10,2),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">6. Tabela</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">itens_pedido</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-itens-pedido">CREATE TABLE itens_pedido (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  pedido_id BIGINT REFERENCES pedidos(id) ON DELETE CASCADE,
  produto_id BIGINT REFERENCES produtos(id),
  quantidade INTEGER,
  preco_unitario NUMERIC(10,2)
);</code></pre>
      </div>
    </section>

    <hr class="my-16 border-t-2 border-gray-200 max-w-4xl mx-auto">

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">7. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_media_avaliacoes</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-media-avaliacoes">CREATE VIEW vw_media_avaliacoes AS
SELECT
  p.id AS produto_id,
  p.nome,
  COUNT(a.id) AS total_avaliacoes,
  ROUND(AVG(a.nota)::numeric, 2) AS media_estrela
FROM produtos p
LEFT JOIN avaliacoes a ON a.produto_id = p.id
GROUP BY p.id, p.nome;</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">8. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_usuarios</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-total-usuarios">CREATE VIEW vw_total_usuarios AS
SELECT COUNT(*) AS total_usuarios FROM usuarios;</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">9. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_produtos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-total-produtos">CREATE VIEW vw_total_produtos AS
SELECT COUNT(*) AS total_produtos FROM produtos;</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">10. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_produtos_por_categoria</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-produtos-por-categoria">CREATE VIEW vw_total_produtos_por_categoria AS
SELECT categoria, COUNT(*) AS total FROM produtos GROUP BY categoria;</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">11. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_produtos_novos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-produtos-novos">CREATE VIEW vw_total_produtos_novos AS
SELECT COUNT(*) AS total_novos FROM produtos WHERE tipo = 'novo';</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">12. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_produtos_usados</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-produtos-usados">CREATE VIEW vw_total_produtos_usados AS
SELECT COUNT(*) AS total_usados FROM produtos WHERE tipo = 'usado';</code></pre>
      </div>
    </section>

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-primary">
      <h2 class="text-3xl font-bold text-primary mb-5 flex items-center">
        <span class="mr-3">13. View</span> <code class="bg-codeBg text-gray-800 px-3 py-1 rounded-md text-xl font-mono border border-gray-300">vw_total_produtos_vendidos</code>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-produtos-vendidos">CREATE VIEW vw_total_produtos_vendidos AS
SELECT SUM(quantidade) AS total_vendidos FROM itens_pedido;</code></pre>
      </div>
    </section>

    <hr class="my-16 border-t-2 border-gray-200 max-w-4xl mx-auto">

    <section class="mb-12 p-8 bg-white rounded-lg shadow-lg border-l-4 border-purple-600">
      <h2 class="text-3xl font-bold text-purple-700 mb-5 flex items-center">
        <span class="mr-3">üéØ Testes de Inser√ß√£o e Limpeza</span>
      </h2>
      <div class="code-block-container">
        <pre class="bg-codeBg p-6 rounded-lg overflow-x-auto text-sm font-mono leading-relaxed shadow-inner border border-gray-200"><code id="code-testes">-- Inserts de teste
-- Usu√°rio de exemplo
INSERT INTO usuarios (nome, email, senha, telefone, avatar_url, papel)
VALUES
  ('Jo√£o Admin', 'admin@teste.com', 'senha123', '69999999999', 'https://exemplo.com/avatar1.png', 'admin'),
  ('Maria Usu√°ria', 'maria@teste.com', 'senha456', '69999999988', 'https://exemplo.com/avatar2.png', 'user');

-- Produtos de exemplo
INSERT INTO produtos (nome, descricao, preco, categoria, imagem_principal, tipo)
VALUES
  ('Fone de Ouvido', 'Fone com Bluetooth e som limpo', 199.99, 'Eletr√¥nicos', 'https://exemplo.com/fone.jpg', 'novo'),
  ('Notebook Usado', 'Notebook semi-novo com SSD', 2499.90, 'Inform√°tica', 'https://exemplo.com/notebook.jpg', 'usado');

-- Fotos dos produtos
INSERT INTO fotos_produtos (produto_id, url)
VALUES
  (1, 'https://exemplo.com/fone1.jpg'),
  (1, 'https://exemplo.com/fone2.jpg'),
  (2, 'https://exemplo.com/notebook1.jpg');

-- Avalia√ß√µes
INSERT INTO avaliacoes (produto_id, usuario_id, nota, comentario)
VALUES
  (1, '00000000-0000-0000-0000-000000000000', 5, 'Produto √≥timo!'),
  (2, '00000000-0000-0000-0000-000000000000', 4, 'Bom custo-benef√≠cio.');

-- Pedidos
INSERT INTO pedidos (usuario_id, status, total)
VALUES
  ('00000000-0000-0000-0000-000000000000', 'pago', 199.99);

-- Itens do pedido
INSERT INTO itens_pedido (pedido_id, produto_id, quantidade, preco_unitario)
VALUES
  (1, 1, 1, 199.99);

-- Limpar dados de teste (DELETE)
-- ATEN√á√ÉO: Use com cuidado em ambiente real
-- DELETE FROM itens_pedido;
-- DELETE FROM pedidos;
-- DELETE FROM avaliacoes;
-- DELETE FROM fotos_produtos;
-- DELETE FROM produtos;
-- DELETE FROM usuarios;</code></pre>
      </div>
    </section>
  </main>

  <footer class="text-center text-gray-500 text-sm mt-20 pt-8 border-t border-gray-200">
    <p>&copy; 2025 Documenta√ß√£o SQL Loja Online. Todos os direitos reservados.</p>
    <p>Criado com ‚ù§Ô∏è e Tailwind CSS.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Seleciona todos os cont√™ineres de bloco de c√≥digo
      const codeBlockContainers = document.querySelectorAll('.code-block-container');

      codeBlockContainers.forEach(container => {
        const pre = container.querySelector('pre');
        const code = container.querySelector('code');

        if (pre && code) {
          // Cria o bot√£o de copiar
          const copyButton = document.createElement('button');
          copyButton.textContent = 'Copiar';
          copyButton.classList.add('copy-button'); // Adiciona a classe de estilo

          // Adiciona o bot√£o ao cont√™iner
          container.appendChild(copyButton);

          // Adiciona o evento de clique ao bot√£o
          copyButton.addEventListener('click', async () => {
            try {
              // Copia o texto do bloco de c√≥digo
              await navigator.clipboard.writeText(code.textContent);
              const originalText = copyButton.textContent;
              copyButton.textContent = 'Copiado!';
              setTimeout(() => {
                copyButton.textContent = originalText;
              }, 2000); // Volta ao texto original ap√≥s 2 segundos
            } catch (err) {
              console.error('Falha ao copiar o texto: ', err);
              alert('Erro ao copiar o c√≥digo. Por favor, copie manualmente.');
            }
          });
        }
      });
    });
  </script>

</body>
</html>